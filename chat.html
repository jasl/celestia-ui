<!DOCTYPE html>
<html lang="zh-CN" data-theme="celestia-light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>聊天 - Celestia</title>
  <meta name="description" content="沉浸式 AI 角色扮演对话">
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✨</text></svg>">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,400;0,700;1,400&family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="./assets/app.css">
  
  <script>
    try {
      const theme = localStorage.getItem('__CELESTIA_THEME__');
      const isDark = theme === 'celestia-dark' || 
        (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches);
      document.documentElement.setAttribute('data-theme', isDark ? 'celestia-dark' : 'celestia-light');
    } catch (e) {}
  </script>
</head>
<body class="h-screen overflow-hidden bg-celestia-gradient antialiased">
  
  <!-- Floating Orbs (decorative) -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    <div class="floating-orb floating-orb-1"></div>
    <div class="floating-orb floating-orb-2"></div>
    <div class="floating-orb floating-orb-3"></div>
  </div>

  <!-- Main Layout -->
  <div class="h-screen flex flex-col">
    
    <!-- Top Bar -->
    <header class="flex-shrink-0 px-4 py-3 relative z-20">
      <div class="glass-panel rounded-full px-4 py-2 flex items-center justify-between gap-4 max-w-7xl mx-auto">
        <!-- Left -->
        <div class="flex items-center gap-3">
          <!-- Logo -->
          <a href="/" class="flex items-center gap-2 mr-2">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-tr from-primary to-secondary flex items-center justify-center text-white">
              <span class="iconify lucide--sparkles size-4"></span>
            </div>
            <span class="font-bold text-lg hidden sm:inline">Celestia</span>
          </a>
          
          <!-- Toggle Left Panel -->
          <button id="toggle-left-panel" class="btn btn-ghost btn-sm btn-circle" title="角色/场景面板">
            <span class="iconify lucide--sidebar size-5"></span>
          </button>
        </div>
        
        <!-- Center - Character Info -->
        <div class="flex items-center gap-3 flex-1 justify-center min-w-0">
          <div class="avatar-ring-gradient">
            <div class="avatar">
              <div class="w-8 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                <span class="text-sm font-medium">A</span>
              </div>
            </div>
          </div>
          <div class="min-w-0">
            <h1 class="font-semibold text-base-content truncate">艾丽西亚</h1>
            <p class="text-xs text-base-content/50 truncate hidden sm:block">魔法学院的神秘导师</p>
          </div>
        </div>
        
        <!-- Right -->
        <div class="flex items-center gap-2">
          <!-- Toggle Right Panel -->
          <button id="toggle-right-panel" class="btn btn-ghost btn-sm btn-circle" title="参数设置">
            <span class="iconify lucide--sliders size-5"></span>
          </button>
          
          <!-- Theme Toggle -->
          <button class="btn btn-ghost btn-sm btn-circle" data-theme-toggle title="切换主题">
            <span class="iconify lucide--sun size-5 hidden" data-theme-icon="light"></span>
            <span class="iconify lucide--moon size-5" data-theme-icon="dark"></span>
          </button>
          
          <!-- User Menu -->
          <details class="dropdown dropdown-end">
            <summary class="btn btn-ghost btn-sm btn-circle">
              <span class="iconify lucide--user size-5"></span>
            </summary>
            <ul class="dropdown-content menu glass-panel rounded-xl w-48 p-2 mt-2 shadow-xl z-50">
              <li><a href="./settings-profile.html"><span class="iconify lucide--settings size-4"></span> 设置</a></li>
              <li><a href="./blog-list.html"><span class="iconify lucide--book-open size-4"></span> 博客</a></li>
              <li><hr class="my-1"></li>
              <li><a href="./auth-login.html" class="text-error"><span class="iconify lucide--log-out size-4"></span> 退出</a></li>
            </ul>
          </details>
        </div>
      </div>
    </header>

    <!-- Content Area -->
    <div class="flex-1 flex overflow-hidden px-4 pb-4 gap-4">
      
      <!-- Left Sidebar - Characters/Scenes -->
      <aside id="left-panel" class="chat-sidebar chat-sidebar-left w-72 flex-shrink-0 hidden lg:flex flex-col">
        <div class="glass-panel rounded-ios h-full flex flex-col overflow-hidden">
          <!-- Tabs -->
          <div class="tabs tabs-box p-2 gap-1 bg-transparent">
            <input type="radio" name="left-tab" class="tab rounded-lg" aria-label="角色" checked>
            <input type="radio" name="left-tab" class="tab rounded-lg" aria-label="场景">
            <input type="radio" name="left-tab" class="tab rounded-lg" aria-label="记忆">
          </div>
          
          <!-- Content -->
          <div class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3">
            <!-- Active Character -->
            <div class="glass-panel rounded-xl p-3 ring-2 ring-primary/30">
              <div class="flex items-center gap-3">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-12 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-lg font-medium">A</span>
                    </div>
                  </div>
                </div>
                <div class="flex-1 min-w-0">
                  <h3 class="font-semibold text-base-content truncate">艾丽西亚</h3>
                  <p class="text-xs text-base-content/60 truncate">魔法学院导师</p>
                </div>
                <span class="badge badge-success badge-xs">在线</span>
              </div>
            </div>
            
            <!-- Character List -->
            <div class="space-y-2">
              <div class="glass-panel rounded-xl p-3 cursor-pointer hover:bg-base-100/50 transition-colors">
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-accent text-accent-content flex items-center justify-center">
                      <span class="text-sm">K</span>
                    </div>
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="font-medium text-sm text-base-content truncate">凯尔</h3>
                    <p class="text-xs text-base-content/50 truncate">骑士团副官</p>
                  </div>
                </div>
              </div>
              
              <div class="glass-panel rounded-xl p-3 cursor-pointer hover:bg-base-100/50 transition-colors">
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-info text-info-content flex items-center justify-center">
                      <span class="text-sm">M</span>
                    </div>
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="font-medium text-sm text-base-content truncate">米娅</h3>
                    <p class="text-xs text-base-content/50 truncate">精灵族使者</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Add New -->
            <button class="btn btn-ghost btn-sm w-full glass-panel rounded-xl border-dashed border-2 border-base-300">
              <span class="iconify lucide--plus size-4"></span>
              添加角色
            </button>
          </div>
        </div>
      </aside>
      
      <!-- Main Chat Area -->
      <main class="flex-1 flex flex-col min-w-0">
        <div class="glass-panel rounded-ios h-full flex flex-col overflow-hidden">
          
          <!-- Messages -->
          <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4">
            
            <!-- System Message -->
            <div class="chat-message flex justify-center">
              <div class="glass-panel rounded-full px-4 py-2 text-xs text-base-content/60">
                <span class="iconify lucide--info size-3 mr-1"></span>
                对话开始于魔法学院的图书馆
              </div>
            </div>
            
            <!-- AI Message -->
            <div class="chat-message chat chat-start">
              <div class="chat-image">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-sm">A</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chat-header mb-1">
                <span class="font-medium text-base-content">艾丽西亚</span>
                <time class="text-xs text-base-content/50 ml-2">刚刚</time>
              </div>
              <div class="chat-bubble chat-bubble-ai rounded-ios p-4">
                <p class="chat-bubble-story">
                  欢迎来到星辉魔法学院的图书馆，年轻的学徒。我是艾丽西亚，负责指导你在这片知识海洋中探索。
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她轻轻合上手中泛黄的古籍，目光柔和地落在你身上，嘴角浮现一丝神秘的微笑。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "你似乎对某种魔法特别感兴趣？不必拘谨，在这里，每一个问题都是通往真理的阶梯。"
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--copy size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--refresh-cw size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
              </div>
            </div>
            
            <!-- User Message -->
            <div class="chat-message chat chat-end">
              <div class="chat-header mb-1">
                <time class="text-xs text-base-content/50 mr-2">刚刚</time>
                <span class="font-medium text-base-content">你</span>
              </div>
              <div class="chat-bubble chat-bubble-user rounded-ios p-4">
                <p class="chat-bubble-story">
                  艾丽西亚老师，我对召唤魔法很感兴趣。我听说您曾经是宫廷的首席召唤师，能否指导我入门？
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2 justify-end">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--trash-2 size-3"></span></button>
              </div>
            </div>
            
            <!-- AI Response -->
            <div class="chat-message chat chat-start">
              <div class="chat-image">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-sm">A</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chat-header mb-1">
                <span class="font-medium text-base-content">艾丽西亚</span>
                <time class="text-xs text-base-content/50 ml-2">刚刚</time>
              </div>
              <div class="chat-bubble chat-bubble-ai rounded-ios p-4">
                <p class="chat-bubble-story">
                  <em>艾丽西亚微微挑眉，眼中闪过一丝惊讶和赞赏。她站起身，走向那排高耸入云的书架。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "召唤魔法啊……这是一门既古老又危险的艺术。你知道吗，每一次召唤，都是与另一个维度的生灵建立契约。"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她从书架上取下一本封面镶嵌着蓝宝石的书籍，书页间隐隐透出柔和的光芒。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "首先，让我们从基础开始——了解召唤的本质。你准备好了吗？"
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--copy size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--refresh-cw size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
              </div>
            </div>
            
          </div>
          
          <!-- Input Area -->
          <div class="flex-shrink-0 p-4 border-t border-base-300/30">
            <div class="flex items-end gap-3">
              <!-- Attachment Button -->
              <button class="btn btn-ghost btn-sm btn-circle flex-shrink-0 mb-1">
                <span class="iconify lucide--paperclip size-5"></span>
              </button>
              
              <!-- Input -->
              <div class="flex-1 relative">
                <textarea 
                  class="textarea glass-input w-full rounded-xl pr-12 resize-none" 
                  placeholder="输入你的回应..."
                  rows="2"
                  style="min-height: 60px; max-height: 150px;"
                ></textarea>
                
                <!-- Send Button (positioned inside) -->
                <button class="btn btn-primary btn-sm btn-circle absolute right-2 bottom-2">
                  <span class="iconify lucide--send size-4"></span>
                </button>
              </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="flex items-center justify-between mt-3 text-xs text-base-content/50">
              <div class="flex items-center gap-2">
                <button class="btn btn-ghost btn-xs gap-1">
                  <span class="iconify lucide--wand-2 size-3"></span>
                  增强
                </button>
                <button class="btn btn-ghost btn-xs gap-1">
                  <span class="iconify lucide--quote size-3"></span>
                  引用
                </button>
              </div>
              <span>Shift + Enter 换行，Enter 发送</span>
            </div>
          </div>
        </div>
      </main>
      
      <!-- Right Sidebar - Settings -->
      <aside id="right-panel" class="chat-sidebar chat-sidebar-right w-72 flex-shrink-0 hidden xl:flex flex-col">
        <div class="glass-panel rounded-ios h-full flex flex-col overflow-hidden">
          <div class="p-4 border-b border-base-300/30">
            <h2 class="font-semibold text-base-content flex items-center gap-2">
              <span class="iconify lucide--sliders size-5 text-primary"></span>
              参数设置
            </h2>
          </div>
          
          <div class="flex-1 overflow-y-auto no-scrollbar p-4 space-y-5">
            <!-- Model Selection -->
            <fieldset class="fieldset">
              <legend class="fieldset-legend text-sm font-medium">模型</legend>
              <select class="select select-sm w-full glass-input rounded-lg">
                <option>Claude 3.5 Sonnet</option>
                <option>GPT-4o</option>
                <option>Gemini Pro</option>
                <option>本地 LLM</option>
              </select>
            </fieldset>
            
            <!-- Temperature -->
            <fieldset class="fieldset">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Temperature</span>
                <span class="text-primary font-mono">0.8</span>
              </legend>
              <input type="range" min="0" max="2" step="0.1" value="0.8" class="range range-primary range-sm">
              <div class="flex justify-between text-xs text-base-content/50 mt-1">
                <span>精确</span>
                <span>创意</span>
              </div>
            </fieldset>
            
            <!-- Max Tokens -->
            <fieldset class="fieldset">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Max Tokens</span>
                <span class="text-primary font-mono">2048</span>
              </legend>
              <input type="range" min="256" max="4096" step="256" value="2048" class="range range-secondary range-sm">
            </fieldset>
            
            <!-- Top P -->
            <fieldset class="fieldset">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Top P</span>
                <span class="text-primary font-mono">0.95</span>
              </legend>
              <input type="range" min="0" max="1" step="0.05" value="0.95" class="range range-accent range-sm">
            </fieldset>
            
            <!-- Presence Penalty -->
            <fieldset class="fieldset">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Presence Penalty</span>
                <span class="text-primary font-mono">0.0</span>
              </legend>
              <input type="range" min="-2" max="2" step="0.1" value="0" class="range range-info range-sm">
            </fieldset>
            
            <!-- Frequency Penalty -->
            <fieldset class="fieldset">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Frequency Penalty</span>
                <span class="text-primary font-mono">0.0</span>
              </legend>
              <input type="range" min="-2" max="2" step="0.1" value="0" class="range range-info range-sm">
            </fieldset>
            
            <hr class="border-base-300/50">
            
            <!-- Toggles -->
            <div class="space-y-3">
              <label class="flex items-center justify-between cursor-pointer">
                <span class="text-sm text-base-content/80">流式输出</span>
                <input type="checkbox" class="toggle toggle-primary toggle-sm" checked>
              </label>
              <label class="flex items-center justify-between cursor-pointer">
                <span class="text-sm text-base-content/80">自动生成标题</span>
                <input type="checkbox" class="toggle toggle-primary toggle-sm" checked>
              </label>
              <label class="flex items-center justify-between cursor-pointer">
                <span class="text-sm text-base-content/80">显示 Token 计数</span>
                <input type="checkbox" class="toggle toggle-primary toggle-sm">
              </label>
            </div>
          </div>
          
          <!-- Footer Actions -->
          <div class="p-4 border-t border-base-300/30">
            <button class="btn btn-ghost btn-sm w-full gap-2">
              <span class="iconify lucide--save size-4"></span>
              保存预设
            </button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Mobile Panel Overlay -->
  <div id="panel-overlay" class="fixed inset-0 bg-black/40 z-30 hidden lg:hidden" onclick="closePanels()"></div>

  <!-- Scripts -->
  <script src="./js/app.js"></script>
  <script src="./js/components/toast.js"></script>
  <script src="./js/components/modal.js"></script>
  
  <script>
    // Panel Toggle Logic
    const leftPanel = document.getElementById('left-panel');
    const rightPanel = document.getElementById('right-panel');
    const panelOverlay = document.getElementById('panel-overlay');
    const toggleLeftBtn = document.getElementById('toggle-left-panel');
    const toggleRightBtn = document.getElementById('toggle-right-panel');
    
    function togglePanel(panel, isRight = false) {
      const isLargeScreen = window.innerWidth >= 1024;
      const isXLScreen = window.innerWidth >= 1280;
      
      if (isLargeScreen && !isRight) {
        panel.classList.toggle('hidden');
        panel.classList.toggle('flex');
      } else if (isXLScreen && isRight) {
        panel.classList.toggle('hidden');
        panel.classList.toggle('flex');
      } else {
        // Mobile behavior
        const isOpen = !panel.classList.contains('collapsed');
        if (isOpen) {
          closePanel(panel);
        } else {
          openPanel(panel);
        }
      }
    }
    
    function openPanel(panel) {
      panel.classList.remove('hidden', 'collapsed');
      panel.classList.add('flex');
      panelOverlay.classList.remove('hidden');
    }
    
    function closePanel(panel) {
      panel.classList.add('collapsed');
      setTimeout(() => {
        if (panel.classList.contains('collapsed')) {
          panel.classList.add('hidden');
          panel.classList.remove('flex');
        }
      }, 300);
      
      // Hide overlay if both panels are closed
      if (leftPanel.classList.contains('collapsed') || leftPanel.classList.contains('hidden')) {
        if (rightPanel.classList.contains('collapsed') || rightPanel.classList.contains('hidden')) {
          panelOverlay.classList.add('hidden');
        }
      }
    }
    
    function closePanels() {
      if (!leftPanel.classList.contains('hidden') && window.innerWidth < 1024) {
        closePanel(leftPanel);
      }
      if (!rightPanel.classList.contains('hidden') && window.innerWidth < 1280) {
        closePanel(rightPanel);
      }
      panelOverlay.classList.add('hidden');
    }
    
    toggleLeftBtn.addEventListener('click', () => togglePanel(leftPanel, false));
    toggleRightBtn.addEventListener('click', () => togglePanel(rightPanel, true));
    
    // Range input value display
    document.querySelectorAll('.range').forEach(range => {
      const legend = range.closest('fieldset').querySelector('.fieldset-legend span.font-mono');
      if (legend) {
        range.addEventListener('input', () => {
          legend.textContent = range.value;
        });
      }
    });
    
    // Textarea auto-resize
    const textarea = document.querySelector('textarea');
    if (textarea) {
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 150) + 'px';
      });
      
      // Enter to send
      textarea.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          // Simulate send
          console.log('Send message:', this.value);
          this.value = '';
          this.style.height = 'auto';
        }
      });
    }
    
    // Scroll to bottom
    const chatMessages = document.getElementById('chat-messages');
    if (chatMessages) {
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  </script>
</body>
</html>

