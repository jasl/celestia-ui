<!DOCTYPE html>
<html lang="zh-CN" data-theme="celestia-light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>聊天 - Celestia</title>
  <meta name="description" content="沉浸式 AI 角色扮演对话">
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✨</text></svg>">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="./assets/app.css">
  
  <script>
    try {
      const theme = localStorage.getItem('__CELESTIA_THEME__');
      const isDark = theme === 'celestia-dark' || 
        (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches);
      document.documentElement.setAttribute('data-theme', isDark ? 'celestia-dark' : 'celestia-light');
    } catch (e) {}
  </script>
</head>
<body class="h-screen overflow-hidden antialiased">
  
  <!-- Background Layer -->
  <div class="fixed inset-0 -z-20 bg-celestia-gradient"></div>
  
  <!-- Floating Orbs (decorative) -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    <div class="floating-orb floating-orb-1"></div>
    <div class="floating-orb floating-orb-2"></div>
    <div class="floating-orb floating-orb-3"></div>
  </div>

  <!-- Main Layout -->
  <div class="h-screen flex flex-col" data-controller="chat-panel chat-panel-right" data-chat-panel-breakpoint-value="1024" data-chat-panel-right-breakpoint-value="1280">
    
    <!-- Top Bar -->
    <header class="flex-shrink-0 px-4 py-3 relative z-50">
      <div class="glass-panel rounded-full px-4 py-2 flex items-center justify-between gap-4">
        <!-- Left -->
        <div class="flex items-center gap-3">
          <!-- Logo -->
          <a href="/" class="flex items-center gap-2 mr-2">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-tr from-primary to-secondary flex items-center justify-center text-white">
              <span class="iconify lucide--sparkles size-4"></span>
            </div>
            <span class="font-bold text-lg hidden sm:inline">Celestia</span>
          </a>
          
          <!-- Toggle Left Panel (hidden on desktop when sidebar is always visible) -->
          <button class="btn btn-ghost btn-sm btn-circle lg:hidden" data-action="click->chat-panel#toggle" title="角色/场景面板">
            <span class="iconify lucide--sidebar size-5"></span>
          </button>
        </div>
        
        <!-- Center - Character Info -->
        <div class="flex items-center gap-3 flex-1 justify-center min-w-0">
          <div class="avatar-ring-gradient">
            <div class="avatar">
              <div class="w-8 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                <span class="text-sm font-medium">A</span>
              </div>
            </div>
          </div>
          <div class="min-w-0">
            <h1 class="font-semibold text-base-content truncate">艾丽西亚</h1>
            <p class="text-xs text-base-content/50 truncate hidden sm:block">魔法学院的神秘导师</p>
          </div>
        </div>
        
        <!-- Right -->
        <div class="flex items-center gap-2">
          <!-- Toggle Right Panel (hidden on desktop when sidebar is always visible) -->
          <button class="btn btn-ghost btn-sm btn-circle xl:hidden" data-action="click->chat-panel-right#toggle" title="参数设置">
            <span class="iconify lucide--sliders size-5"></span>
          </button>
          
          <!-- Theme Toggle -->
          <button class="btn btn-ghost btn-sm btn-circle" data-controller="theme" data-action="click->theme#toggle" title="切换主题">
            <span class="iconify lucide--sun size-5 hidden" data-theme-target="sunIcon"></span>
            <span class="iconify lucide--moon size-5" data-theme-target="moonIcon"></span>
          </button>
          
          <!-- User Menu -->
          <details class="dropdown dropdown-end">
            <summary class="btn btn-ghost btn-sm btn-circle">
              <span class="iconify lucide--user size-5"></span>
            </summary>
            <ul class="dropdown-content menu glass-panel rounded-xl w-48 p-2 mt-2 shadow-xl z-50">
              <li><a href="./settings-profile.html"><span class="iconify lucide--settings size-4"></span> 设置</a></li>
              <li><a href="./blog-list.html"><span class="iconify lucide--book-open size-4"></span> 博客</a></li>
              <li><hr class="my-1"></li>
              <li><a href="./auth-login.html" class="text-error"><span class="iconify lucide--log-out size-4"></span> 退出</a></li>
            </ul>
          </details>
        </div>
      </div>
    </header>

    <!-- Content Area -->
    <div class="flex-1 flex overflow-hidden px-4 pb-4 gap-4">
      
      <!-- Left Sidebar - Characters/Scenes -->
      <aside id="left-panel" class="chat-sidebar chat-sidebar-left w-72 flex-shrink-0 flex-col" data-visible="auto" data-chat-panel-target="panel">
        <div class="glass-panel rounded-[2rem] h-full flex flex-col overflow-hidden">
          <!-- Tabs -->
          <div class="tabs tabs-box p-2 gap-1 bg-transparent w-full">
            <input type="radio" name="left-tab" class="tab flex-1 rounded-[2rem]" aria-label="角色" checked>
            <input type="radio" name="left-tab" class="tab flex-1 rounded-[2rem]" aria-label="场景">
            <input type="radio" name="left-tab" class="tab flex-1 rounded-[2rem]" aria-label="记忆">
          </div>
          
          <!-- Content -->
          <div class="flex-1 overflow-y-auto no-scrollbar p-3 space-y-3">
            <!-- Active Character -->
            <div class="glass-panel rounded-xl p-3 ring-2 ring-primary/30">
              <div class="flex items-center gap-3">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-12 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-lg font-medium">A</span>
                    </div>
                  </div>
                </div>
                <div class="flex-1 min-w-0">
                  <h3 class="font-semibold text-base-content truncate">艾丽西亚</h3>
                  <p class="text-xs text-base-content/60 truncate">魔法学院导师</p>
                </div>
                <span class="badge badge-success badge-xs">在线</span>
              </div>
            </div>
            
            <!-- Character List -->
            <div class="space-y-2">
              <div class="glass-panel rounded-xl p-3 cursor-pointer hover:bg-base-100/50 transition-colors">
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-accent text-accent-content flex items-center justify-center">
                      <span class="text-sm">K</span>
                    </div>
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="font-medium text-sm text-base-content truncate">凯尔</h3>
                    <p class="text-xs text-base-content/50 truncate">骑士团副官</p>
                  </div>
                  <span class="badge badge-success badge-xs">在线</span>
                </div>
              </div>
              
              <div class="glass-panel rounded-xl p-3 cursor-pointer hover:bg-base-100/50 transition-colors">
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-info text-info-content flex items-center justify-center">
                      <span class="text-sm">M</span>
                    </div>
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="font-medium text-sm text-base-content truncate">米娅</h3>
                    <p class="text-xs text-base-content/50 truncate">精灵族使者</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Add New -->
            <button class="btn btn-ghost btn-sm w-full glass-panel rounded-xl border-dashed border-2 border-base-300">
              <span class="iconify lucide--plus size-4"></span>
              添加角色
            </button>
          </div>
        </div>
      </aside>
      
      <!-- Main Chat Area -->
      <main class="flex-1 flex flex-col min-w-0">
        <div class="glass-panel rounded-[2rem] h-full flex flex-col overflow-hidden">
          
          <!-- Messages -->
          <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4">
            
            <!-- System Message -->
            <div class="chat-message flex justify-center">
              <div class="glass-panel rounded-full px-4 py-2 text-xs text-base-content/60">
                <span class="iconify lucide--info size-3 mr-1"></span>
                对话开始于魔法学院的图书馆
              </div>
            </div>
            
            <!-- AI Message 1 -->
            <div class="chat-message chat chat-start">
              <div class="chat-image">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-sm">A</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chat-header mb-1">
                <span class="font-medium text-base-content">艾丽西亚</span>
                <time class="text-xs text-base-content/50 ml-2">10分钟前</time>
              </div>
              <div class="chat-bubble chat-bubble-ai p-4">
                <p class="chat-bubble-story">
                  欢迎来到星辉魔法学院的图书馆，年轻的学徒。我是艾丽西亚，负责指导你在这片知识海洋中探索。
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她轻轻合上手中泛黄的古籍，目光柔和地落在你身上，嘴角浮现一丝神秘的微笑。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "你似乎对某种魔法特别感兴趣？不必拘谨，在这里，每一个问题都是通往真理的阶梯。"
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--copy size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--refresh-cw size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
              </div>
            </div>
            
            <!-- User Message 1 -->
            <div class="chat-message chat chat-end">
              <div class="chat-header mb-1">
                <time class="text-xs text-base-content/50 mr-2">9分钟前</time>
                <span class="font-medium text-base-content">你</span>
              </div>
              <div class="chat-bubble chat-bubble-user p-4">
                <p class="chat-bubble-story">
                  艾丽西亚老师，我对召唤魔法很感兴趣。我听说您曾经是宫廷的首席召唤师，能否指导我入门？
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2 justify-end">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--trash-2 size-3"></span></button>
              </div>
            </div>
            
            <!-- AI Response 2 -->
            <div class="chat-message chat chat-start">
              <div class="chat-image">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-sm">A</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chat-header mb-1">
                <span class="font-medium text-base-content">艾丽西亚</span>
                <time class="text-xs text-base-content/50 ml-2">8分钟前</time>
              </div>
              <div class="chat-bubble chat-bubble-ai p-4">
                <p class="chat-bubble-story">
                  <em>艾丽西亚微微挑眉，眼中闪过一丝惊讶和赞赏。她站起身，走向那排高耸入云的书架。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "召唤魔法啊……这是一门既古老又危险的艺术。你知道吗，每一次召唤，都是与另一个维度的生灵建立契约。"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她从书架上取下一本封面镶嵌着蓝宝石的书籍，书页间隐隐透出柔和的光芒。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "首先，让我们从基础开始——了解召唤的本质。你准备好了吗？"
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--copy size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--refresh-cw size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
              </div>
            </div>
            
            <!-- User Message 2 -->
            <div class="chat-message chat chat-end">
              <div class="chat-header mb-1">
                <time class="text-xs text-base-content/50 mr-2">7分钟前</time>
                <span class="font-medium text-base-content">你</span>
              </div>
              <div class="chat-bubble chat-bubble-user p-4">
                <p class="chat-bubble-story">
                  是的，我准备好了！请告诉我，召唤魔法的本质是什么？为什么说它既古老又危险？
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2 justify-end">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--trash-2 size-3"></span></button>
              </div>
            </div>
            
            <!-- AI Response 3 -->
            <div class="chat-message chat chat-start">
              <div class="chat-image">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-sm">A</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chat-header mb-1">
                <span class="font-medium text-base-content">艾丽西亚</span>
                <time class="text-xs text-base-content/50 ml-2">6分钟前</time>
              </div>
              <div class="chat-bubble chat-bubble-ai p-4">
                <p class="chat-bubble-story">
                  <em>艾丽西亚翻开书籍，一道淡蓝色的光芒从书页中升起，在空中形成一个复杂的魔法阵图案。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "看，这是最基础的召唤阵。召唤魔法的本质，是在不同的维度之间建立一道'桥梁'。通过这座桥梁，你可以呼唤另一个世界的生灵来到这里。"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她的手指轻轻划过光芒构成的符文，每一个符文都发出清脆的鸣响。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "之所以说它危险，是因为每一次召唤都需要付出代价。如果你无法掌控被召唤的生灵，或者契约出了问题……"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她的眼神变得深邃，似乎想起了什么往事。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "后果可能是灾难性的。"
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--copy size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--refresh-cw size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
              </div>
            </div>
            
            <!-- User Message 3 -->
            <div class="chat-message chat chat-end">
              <div class="chat-header mb-1">
                <time class="text-xs text-base-content/50 mr-2">5分钟前</time>
                <span class="font-medium text-base-content">你</span>
              </div>
              <div class="chat-bubble chat-bubble-user p-4">
                <p class="chat-bubble-story">
                  这听起来确实很危险……您提到需要付出代价，具体是什么样的代价呢？我需要准备什么吗？
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2 justify-end">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--trash-2 size-3"></span></button>
              </div>
            </div>
            
            <!-- AI Response 4 -->
            <div class="chat-message chat chat-start">
              <div class="chat-image">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-sm">A</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chat-header mb-1">
                <span class="font-medium text-base-content">艾丽西亚</span>
                <time class="text-xs text-base-content/50 ml-2">4分钟前</time>
              </div>
              <div class="chat-bubble chat-bubble-ai p-4">
                <p class="chat-bubble-story">
                  <em>艾丽西亚欣慰地点点头，似乎对你的谨慎态度感到满意。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "问得好。代价有很多种形式——最常见的是魔力消耗。召唤越强大的生灵，需要的魔力就越多。但这还是最轻的。"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她从书架旁的抽屉里取出一块发光的水晶，水晶内部似乎封印着某种流动的能量。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "有些契约需要你献上记忆、情感，甚至是寿命。而最危险的契约……"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她压低声音，神情严肃。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "会要求你献上灵魂的一部分。所以，在学习召唤魔法之前，你必须先学会评估风险，以及——如何拒绝一个不公平的契约。"
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--copy size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--refresh-cw size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
              </div>
            </div>
            
            <!-- User Message 4 -->
            <div class="chat-message chat chat-end">
              <div class="chat-header mb-1">
                <time class="text-xs text-base-content/50 mr-2">3分钟前</time>
                <span class="font-medium text-base-content">你</span>
              </div>
              <div class="chat-bubble chat-bubble-user p-4">
                <p class="chat-bubble-story">
                  我明白了，这比我想象的要复杂得多。那么，对于初学者来说，有没有相对安全的召唤对象可以练习？
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2 justify-end">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--trash-2 size-3"></span></button>
              </div>
            </div>
            
            <!-- AI Response 5 -->
            <div class="chat-message chat chat-start">
              <div class="chat-image">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-sm">A</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chat-header mb-1">
                <span class="font-medium text-base-content">艾丽西亚</span>
                <time class="text-xs text-base-content/50 ml-2">2分钟前</time>
              </div>
              <div class="chat-bubble chat-bubble-ai p-4">
                <p class="chat-bubble-story">
                  <em>艾丽西亚的嘴角终于露出一丝温和的笑意，她轻轻挥动手指，那道悬浮的魔法阵缩小成一个小巧的光球。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "当然有。对于初学者，我们通常从'元素精灵'开始。它们是自然界中最温和的存在，契约条件也很简单——只需要你的一点点魔力作为供养。"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她将光球轻轻放在你的掌心，温暖的能量从光球中传来。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "来，试着感受这个魔法阵的结构。闭上眼睛，用你的意识去触碰它……告诉我，你感受到了什么？"
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--copy size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--refresh-cw size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
              </div>
            </div>
            
            <!-- User Message 5 -->
            <div class="chat-message chat chat-end">
              <div class="chat-header mb-1">
                <time class="text-xs text-base-content/50 mr-2">1分钟前</time>
                <span class="font-medium text-base-content">你</span>
              </div>
              <div class="chat-bubble chat-bubble-user p-4">
                <p class="chat-bubble-story">
                  <em>我闭上眼睛，将注意力集中在掌心的光球上。起初只感到温暖，但渐渐地，我仿佛能"看到"一些东西……</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  我感觉到……像是很多条细线交织在一起，它们在不断流动、旋转。中心似乎有一个空洞，像是在等待什么东西填充进去？
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2 justify-end">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--trash-2 size-3"></span></button>
              </div>
            </div>
            
            <!-- AI Response 6 (Latest) -->
            <div class="chat-message chat chat-start">
              <div class="chat-image">
                <div class="avatar-ring-gradient">
                  <div class="avatar">
                    <div class="w-10 rounded-full bg-secondary text-secondary-content flex items-center justify-center">
                      <span class="text-sm">A</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="chat-header mb-1">
                <span class="font-medium text-base-content">艾丽西亚</span>
                <time class="text-xs text-base-content/50 ml-2">刚刚</time>
              </div>
              <div class="chat-bubble chat-bubble-ai p-4">
                <p class="chat-bubble-story">
                  <em>艾丽西亚的眼中闪过一丝惊喜，她不由自主地向前倾身，声音中带着难以掩饰的激动。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "了不起！你竟然能感知到魔法阵的'经络'和'核心空洞'！这种感知能力，通常需要数月的训练才能获得……"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她站起身，走到窗边，夕阳的余晖给她披上了一层金色的光芒。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "你说的'空洞'，正是召唤魔法的关键——那是'召唤之座'，是被召唤者降临的位置。而那些'细线'是魔力的流通渠道，决定了契约的性质。"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她转过身，眼神中充满期待。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "看来你是天生的召唤师。如果你愿意，从明天开始，我可以正式收你为徒。不过……"
                </p>
                <p class="chat-bubble-story mt-3">
                  <em>她的表情变得严肃。</em>
                </p>
                <p class="chat-bubble-story mt-3">
                  "在那之前，你需要做一个选择。召唤师有两条路——'契约之路'与'支配之路'。前者与召唤物平等相待，后者则追求绝对的控制。你会选择哪一条？"
                </p>
              </div>
              <div class="chat-footer text-xs text-base-content/50 mt-1 flex items-center gap-2">
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--copy size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--refresh-cw size-3"></span></button>
                <button class="btn btn-ghost btn-xs btn-circle"><span class="iconify lucide--edit-3 size-3"></span></button>
              </div>
            </div>
            
          </div>
          
          <!-- Input Area -->
          <div class="flex-shrink-0 p-4 border-t border-base-300/30">
            
            <!-- Quick Replies -->
            <div class="mb-3" data-controller="quick-replies" data-quick-replies-collapsed-height-value="32">
              <div class="flex items-center gap-2">
                <!-- Quick Reply Buttons Wrapper -->
                <div 
                  data-quick-replies-target="wrapper"
                  class="flex-1 overflow-hidden transition-all duration-300"
                  style="max-height: 32px;"
                >
                  <div data-quick-replies-target="list" class="flex flex-wrap gap-2">
                    <button class="btn btn-ghost btn-xs glass-panel rounded-full whitespace-nowrap hover:bg-primary/10 hover:text-primary transition-colors" data-action="click->quick-replies#select">
                      我选择契约之路
                    </button>
                    <button class="btn btn-ghost btn-xs glass-panel rounded-full whitespace-nowrap hover:bg-primary/10 hover:text-primary transition-colors" data-action="click->quick-replies#select">
                      我选择支配之路
                    </button>
                    <button class="btn btn-ghost btn-xs glass-panel rounded-full whitespace-nowrap hover:bg-primary/10 hover:text-primary transition-colors" data-action="click->quick-replies#select">
                      能详细说明两条路的区别吗？
                    </button>
                    <button class="btn btn-ghost btn-xs glass-panel rounded-full whitespace-nowrap hover:bg-primary/10 hover:text-primary transition-colors" data-action="click->quick-replies#select">
                      我需要更多时间考虑
                    </button>
                    <button class="btn btn-ghost btn-xs glass-panel rounded-full whitespace-nowrap hover:bg-primary/10 hover:text-primary transition-colors" data-action="click->quick-replies#select">
                      您当初选择了哪条路？
                    </button>
                    <button class="btn btn-ghost btn-xs glass-panel rounded-full whitespace-nowrap hover:bg-primary/10 hover:text-primary transition-colors" data-action="click->quick-replies#select">
                      两条路可以切换吗？
                    </button>
                    <button class="btn btn-ghost btn-xs glass-panel rounded-full whitespace-nowrap hover:bg-primary/10 hover:text-primary transition-colors" data-action="click->quick-replies#select">
                      选择后会有什么影响？
                    </button>
                  </div>
                </div>
                
                <!-- Expand/Collapse Toggle -->
                <button 
                  data-quick-replies-target="toggle"
                  class="btn btn-ghost btn-xs btn-circle flex-shrink-0 text-base-content/50 hover:text-primary hidden"
                  title="展开/收起"
                  data-action="click->quick-replies#toggle"
                >
                  <span class="iconify lucide--chevron-up size-4 transition-transform duration-300" data-quick-replies-target="icon"></span>
                </button>
              </div>
            </div>
            
            <div class="flex items-end gap-3">
              <!-- Attachment Button -->
              <button class="btn btn-ghost btn-sm btn-circle flex-shrink-0 mb-1">
                <span class="iconify lucide--paperclip size-5"></span>
              </button>
              
              <!-- Input -->
              <div class="flex-1 relative" data-controller="textarea-autoresize" data-textarea-autoresize-max-height-value="150">
                <textarea 
                  class="textarea glass-input w-full rounded-xl pr-12 resize-none" 
                  placeholder="输入你的回应..."
                  rows="2"
                  style="min-height: 60px; max-height: 150px;"
                  data-action="input->textarea-autoresize#resize keydown->textarea-autoresize#handleKeydown"
                  id="chat-textarea"
                ></textarea>
                
                <!-- Send Button (positioned inside) -->
                <button class="btn btn-primary btn-sm btn-circle absolute right-2 bottom-2">
                  <span class="iconify lucide--send size-4"></span>
                </button>
              </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="flex items-center justify-between mt-3 text-xs text-base-content/50">
              <div class="flex items-center gap-2">
                <button class="btn btn-ghost btn-xs gap-1">
                  <span class="iconify lucide--wand-2 size-3"></span>
                  增强
                </button>
                <button class="btn btn-ghost btn-xs gap-1">
                  <span class="iconify lucide--quote size-3"></span>
                  引用
                </button>
              </div>
              <span>Shift + Enter 换行，Enter 发送</span>
            </div>
          </div>
        </div>
      </main>
      
      <!-- Right Sidebar - Settings -->
      <aside id="right-panel" class="chat-sidebar chat-sidebar-right w-72 flex-shrink-0 flex-col" data-visible="auto" data-chat-panel-right-target="panel">
        <div class="glass-panel rounded-[2rem] h-full flex flex-col overflow-hidden">
          <div class="p-4 border-b border-base-300/30">
            <h2 class="font-semibold text-base-content flex items-center gap-2">
              <span class="iconify lucide--sliders size-5 text-primary"></span>
              参数设置
            </h2>
          </div>
          
          <div class="flex-1 overflow-y-auto no-scrollbar p-4 space-y-5">
            <!-- Model Selection -->
            <fieldset class="fieldset">
              <legend class="fieldset-legend text-sm font-medium">模型</legend>
              <select class="select select-sm w-full glass-input rounded-lg">
                <option>Claude 3.5 Sonnet</option>
                <option>GPT-4o</option>
                <option>Gemini Pro</option>
                <option>本地 LLM</option>
              </select>
            </fieldset>
            
            <!-- Temperature -->
            <fieldset class="fieldset" data-controller="range-display">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Temperature</span>
                <span class="text-primary font-mono" data-range-display-target="display">0.8</span>
              </legend>
              <input type="range" min="0" max="2" step="0.1" value="0.8" class="range range-primary range-sm" data-range-display-target="input" data-action="input->range-display#update">
              <div class="flex justify-between text-xs text-base-content/50 mt-1">
                <span>精确</span>
                <span>创意</span>
              </div>
            </fieldset>
            
            <!-- Max Tokens -->
            <fieldset class="fieldset" data-controller="range-display">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Max Tokens</span>
                <span class="text-primary font-mono" data-range-display-target="display">2048</span>
              </legend>
              <input type="range" min="256" max="4096" step="256" value="2048" class="range range-secondary range-sm" data-range-display-target="input" data-action="input->range-display#update">
            </fieldset>
            
            <!-- Top P -->
            <fieldset class="fieldset" data-controller="range-display">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Top P</span>
                <span class="text-primary font-mono" data-range-display-target="display">0.95</span>
              </legend>
              <input type="range" min="0" max="1" step="0.05" value="0.95" class="range range-accent range-sm" data-range-display-target="input" data-action="input->range-display#update">
            </fieldset>
            
            <!-- Presence Penalty -->
            <fieldset class="fieldset" data-controller="range-display">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Presence Penalty</span>
                <span class="text-primary font-mono" data-range-display-target="display">0.0</span>
              </legend>
              <input type="range" min="-2" max="2" step="0.1" value="0" class="range range-info range-sm" data-range-display-target="input" data-action="input->range-display#update">
            </fieldset>
            
            <!-- Frequency Penalty -->
            <fieldset class="fieldset" data-controller="range-display">
              <legend class="fieldset-legend text-sm font-medium flex items-center justify-between">
                <span>Frequency Penalty</span>
                <span class="text-primary font-mono" data-range-display-target="display">0.0</span>
              </legend>
              <input type="range" min="-2" max="2" step="0.1" value="0" class="range range-info range-sm" data-range-display-target="input" data-action="input->range-display#update">
            </fieldset>
            
<div class="divider"></div>

            <!-- Toggles -->
            <div class="space-y-3">
              <label class="flex items-center justify-between cursor-pointer">
                <span class="text-sm text-base-content/80">流式输出</span>
                <input type="checkbox" class="toggle toggle-primary toggle-sm" checked>
              </label>
              <label class="flex items-center justify-between cursor-pointer">
                <span class="text-sm text-base-content/80">自动生成标题</span>
                <input type="checkbox" class="toggle toggle-primary toggle-sm" checked>
              </label>
              <label class="flex items-center justify-between cursor-pointer">
                <span class="text-sm text-base-content/80">显示 Token 计数</span>
                <input type="checkbox" class="toggle toggle-primary toggle-sm">
              </label>
            </div>
          </div>
          
          <!-- Footer Actions -->
          <div class="p-4 border-t border-base-300/30">
            <button class="btn btn-ghost btn-sm w-full gap-2">
              <span class="iconify lucide--save size-4"></span>
              保存预设
            </button>
          </div>
        </div>
      </aside>
    </div>

    <!-- Mobile Panel Overlay -->
    <div id="panel-overlay" class="fixed inset-0 bg-black/40 z-30 hidden lg:hidden" data-chat-panel-target="overlay" data-chat-panel-right-target="overlay" data-action="click->chat-panel#close click->chat-panel-right#close"></div>
  </div>

  <!-- Toast Container -->
  <div data-controller="toast"></div>

  <!-- Modal Container -->
  <div data-controller="modal"></div>

  <!-- Scripts -->
  <script type="module" src="./js/application.js"></script>
  
  <script type="module">
    // Scroll to bottom on page load
    const chatMessages = document.getElementById('chat-messages');
    if (chatMessages) {
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // Handle quick replies selection - fill textarea
    document.addEventListener('quick-replies:selected', (event) => {
      const textarea = document.getElementById('chat-textarea');
      if (textarea) {
        textarea.value = event.detail.text;
        textarea.focus();
        textarea.dispatchEvent(new Event('input'));
      }
    });
  </script>
</body>
</html>
